<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usage &mdash; k8s-tew  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Setups" href="setups.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> k8s-tew
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.4.10
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#labels">Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#workflow">Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-remote-node">Add Remote Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-local-node">Add Local Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remove-node">Remove Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#list-nodes">List Nodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#generating-files">Generating Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run">Run</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deploy">Deploy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#environment">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dashboards-websites">Dashboards &amp; Websites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ingress">Ingress</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="setups.html">Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">k8s-tew</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h1>
<p>All k8s-tew commands accept the argument <code class="file docutils literal notranslate"><span class="pre">--base-directory</span></code>, which defines where all the files (binaries, certificates, configurations and so on) will be stored. If no value is defined then it will create a subdirectory called “assets” in the working directory. Additionally, the environment variable K8S_TEW_BASE_DIRECTORY can be set to point to the assets directory instead of using <code class="file docutils literal notranslate"><span class="pre">--base-directory</span></code>.</p>
<p>To see all the commands and their arguments use the <code class="file docutils literal notranslate"><span class="pre">-h</span></code> argument.</p>
<p>To activate completion for bash enter:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> &lt;<span class="o">(</span>k8s-tew completion<span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<p>For zsh run:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> &lt;<span class="o">(</span>k8s-tew completion zsh<span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>k8s-tew was tested so far on Ubuntu 20.04 and CentOS 8.2. But it should be able to run on other Linux distributions.</p>
<p>Host related dependencies such as socat, conntrack, ipset and rbd are embedded in k8s-tew and put in place, once the cluster is running. Thus it is fairly portable to other Linux distributions.</p>
</section>
<section id="labels">
<h2>Labels<a class="headerlink" href="#labels" title="Permalink to this heading"></a></h2>
<p>k8s-tew uses labels to specify which files belong on a node, which commands should be executed on a node and also which components need to be started on a node. They are similar to Kubernetes’ Labels and Selectors.</p>
<ul class="simple">
<li><p>bootstrapper - This label marks bootstrapping node/commands</p></li>
<li><p>controller - Kubernetes Controler. At least three controller nodes are required for a HA cluster.</p></li>
<li><p>worker - Kubernetes Node/Minion. At least one worker node is required.</p></li>
<li><p>storage - The Ceph Monitors are installed on the controller nodes. The storage nodes are used to store the actual data of the pods, and also to run the containers related to Ceph and CSI.</p></li>
</ul>
</section>
<section id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this heading"></a></h2>
<p>To setup a local single-node cluster, the workflow is: initialize -&gt; configure -&gt; generate -&gt; run</p>
<p>For a remote cluster, the workflow is: initialize -&gt; configure -&gt; generate -&gt; deploy</p>
<p>If something in one of the steps is changed, (e.g. configuration), then all the following steps have to be performed.</p>
<section id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this heading"></a></h3>
<p>The first step in using k8s-tew is to create a config file. This is achieved by executing this command:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew initialize
</pre></div>
</div>
</div></blockquote>
<p>That command generates the config file called <code class="file docutils literal notranslate"><em><span class="pre">base-directory</span></em><span class="pre">/etc/k8s-tew/config.yaml</span></code>. To overwrite the existing configuration use the argument -f.</p>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<p>After the initialization step the parameters of the cluster should be be adapted. These are the configure parameters and their defaults:</p>
<blockquote>
<div><dl class="option-list">
<dt><kbd><span class="option">--alert-manager-count <var>uint16</var></span></kbd></dt>
<dd><p>Number of Alert Manager Servers (default 1)</p>
</dd>
<dt><kbd><span class="option">--alert-manager-size <var>uint16</var></span></kbd></dt>
<dd><p>Size of Alert Manager Persistent Volume (default 2)</p>
</dd>
<dt><kbd><span class="option">--apiserver-port <var>uint16</var></span></kbd></dt>
<dd><p>API Server Port (default 6443)</p>
</dd>
<dt><kbd><span class="option">--ca-certificate-validity-period <var>uint16</var></span></kbd></dt>
<dd><p>CA Certificate Validity Period (default 20)</p>
</dd>
<dt><kbd><span class="option">--calico-typha-ip <var>string</var></span></kbd></dt>
<dd><p>Calico Typha IP (default “10.32.0.5”)</p>
</dd>
<dt><kbd><span class="option">--ceph-cluster-name <var>string</var></span></kbd></dt>
<dd><p>Ceph Cluster Name (default “ceph”)</p>
</dd>
<dt><kbd><span class="option">--ceph-expected-number-of-objects <var>uint</var></span></kbd></dt>
<dd><p>Ceph Expected Number of Objects (default 1000000)</p>
</dd>
<dt><kbd><span class="option">--ceph-placement-groups <var>uint</var></span></kbd></dt>
<dd><p>Ceph Placement Groups (default 256)</p>
</dd>
<dt><kbd><span class="option">--client-certificate-validity-period <var>uint16</var></span></kbd></dt>
<dd><p>Client Certificate Validity Period (default 15)</p>
</dd>
<dt><kbd><span class="option">--cluster-cidr <var>string</var></span></kbd></dt>
<dd><p>Cluster CIDR (default “10.200.0.0/16”)</p>
</dd>
<dt><kbd><span class="option">--cluster-dns-ip <var>string</var></span></kbd></dt>
<dd><p>Cluster DNS IP (default “10.32.0.10”)</p>
</dd>
<dt><kbd><span class="option">--cluster-domain <var>string</var></span></kbd></dt>
<dd><p>Cluster domain (default “cluster.local”)</p>
</dd>
<dt><kbd><span class="option">--cluster-ip-range <var>string</var></span></kbd></dt>
<dd><p>Cluster IP range (default “10.32.0.0/24”)</p>
</dd>
<dt><kbd><span class="option">--cluster-name <var>string</var></span></kbd></dt>
<dd><p>Cluster Name used for Kubernetes Dashboard (default “k8s-tew”)</p>
</dd>
<dt><kbd><span class="option">--controller-virtual-ip <var>string</var></span></kbd></dt>
<dd><p>Controller Virtual/Floating IP for the cluster</p>
</dd>
<dt><kbd><span class="option">--controller-virtual-ip-interface <var>string</var></span></kbd></dt>
<dd><p>Controller Virtual/Floating IP interface for the cluster</p>
</dd>
<dt><kbd><span class="option">--deployment-directory <var>string</var></span></kbd></dt>
<dd><p>Deployment directory (default “/”)</p>
</dd>
<dt><kbd><span class="option">--elasticsearch-count <var>uint16</var></span></kbd></dt>
<dd><p>Number of Elasticsearch Servers (default 1)</p>
</dd>
<dt><kbd><span class="option">--elasticsearch-size <var>uint16</var></span></kbd></dt>
<dd><p>Size of Elasticsearch Persistent Volume (default 10)</p>
</dd>
<dt><kbd><span class="option">--email <var>string</var></span></kbd></dt>
<dd><p>Email address used for example for Let’s Encrypt (default “<a class="reference external" href="mailto:k8s-tew&#37;&#52;&#48;gmail&#46;com">k8s-tew<span>&#64;</span>gmail<span>&#46;</span>com</a>”)</p>
</dd>
<dt><kbd><span class="option">--grafana-size <var>uint16</var></span></kbd></dt>
<dd><p>Size of Grafana Persistent Volume (default 2)</p>
</dd>
<dt><kbd><span class="option">--help</span></kbd></dt>
<dd><p>help for configure</p>
</dd>
<dt><kbd><span class="option">--ingress-domain <var>string</var></span></kbd></dt>
<dd><p>Ingress domain name (default “k8s-tew.net”)</p>
</dd>
<dt><kbd><span class="option">--kube-state-metrics-count <var>uint16</var></span></kbd></dt>
<dd><p>Number of Kube State Metrics Servers (default 1)</p>
</dd>
<dt><kbd><span class="option">--kubernetes-dashboard-port <var>uint16</var></span></kbd></dt>
<dd><p>Kubernetes Dashboard Port (default 32443)</p>
</dd>
<dt><kbd><span class="option">--load-balancer-port <var>uint16</var></span></kbd></dt>
<dd><p>Load Balancer Port (default 32443)</p>
</dd>
<dt><kbd><span class="option">--max-pods <var>uint16</var></span></kbd></dt>
<dd><p>MaxPods (default 110)</p>
</dd>
<dt><kbd><span class="option">--metallb-addresses <var>string</var></span></kbd></dt>
<dd><p>Comma separated MetalLB address ranges and CIDR (e.g 192.168.0.16/28,192.168.0.75-192.168.0.100) (default “192.168.0.16/28”)</p>
</dd>
<dt><kbd><span class="option">--minio-size <var>uint16</var></span></kbd></dt>
<dd><p>Size of Minio Persistent Volume (default 2)</p>
</dd>
<dt><kbd><span class="option">--prometheus-size <var>uint16</var></span></kbd></dt>
<dd><p>Size of Prometheus Persistent Volume (default 2)</p>
</dd>
<dt><kbd><span class="option">--public-network <var>string</var></span></kbd></dt>
<dd><p>Public Network (default “192.168.100.0/24”)</p>
</dd>
<dt><kbd><span class="option">--resolv-conf <var>string</var></span></kbd></dt>
<dd><p>Custom resolv.conf (default “/etc/resolv.conf”)</p>
</dd>
<dt><kbd><span class="option">--rsa-key-size <var>uint16</var></span></kbd></dt>
<dd><p>RSA Key Size (default 2048)</p>
</dd>
<dt><kbd><span class="option">--san-dns-names <var>string</var></span></kbd></dt>
<dd><p>SAN DNS Names (comma separated)</p>
</dd>
<dt><kbd><span class="option">--san-ip-addresses <var>string</var></span></kbd></dt>
<dd><p>SAN IP Addresses (comma separated)</p>
</dd>
<dt><kbd><span class="option">--version-alert-manager <var>string</var></span></kbd></dt>
<dd><p>Alert Manager version (default “quay.io/prometheus/alertmanager:v0.21.0”)</p>
</dd>
<dt><kbd><span class="option">--version-busybox <var>string</var></span></kbd></dt>
<dd><p>Busybox version (default “docker.io/library/busybox:1.32.0”)</p>
</dd>
<dt><kbd><span class="option">--version-calico-cni <var>string</var></span></kbd></dt>
<dd><p>Calico CNI version (default “quay.io/calico/cni:v3.16.4”)</p>
</dd>
<dt><kbd><span class="option">--version-calico-kube-controllers <var>string</var></span></kbd></dt>
<dd><p>Calico Kube Controllers  version (default “quay.io/calico/kube-controllers:v3.16.4”)</p>
</dd>
<dt><kbd><span class="option">--version-calico-node <var>string</var></span></kbd></dt>
<dd><p>Calico Node version (default “quay.io/calico/node:v3.16.4”)</p>
</dd>
<dt><kbd><span class="option">--version-calico-pod2daemon <var>string</var></span></kbd></dt>
<dd><p>Calico Pod2Daemon version (default “quay.io/calico/pod2daemon-flexvol:v3.16.4”)</p>
</dd>
<dt><kbd><span class="option">--version-calico-typha <var>string</var></span></kbd></dt>
<dd><p>Calico Typha version (default “quay.io/calico/typha:v3.16.4”)</p>
</dd>
<dt><kbd><span class="option">--version-ceph <var>string</var></span></kbd></dt>
<dd><p>Ceph version (default “docker.io/ceph/ceph:v15.2.5”)</p>
</dd>
<dt><kbd><span class="option">--version-cerebro <var>string</var></span></kbd></dt>
<dd><p>Cerebro version (default “docker.io/lmenezes/cerebro:0.9.2”)</p>
</dd>
<dt><kbd><span class="option">--version-cert-manager-cainjector <var>string</var></span></kbd></dt>
<dd><p>Cert Manager CA Injector version (default “quay.io/jetstack/cert-manager-cainjector:v1.0.3”)</p>
</dd>
<dt><kbd><span class="option">--version-cert-manager-controller <var>string</var></span></kbd></dt>
<dd><p>Cert Manager Controller version (default “quay.io/jetstack/cert-manager-controller:v1.0.3”)</p>
</dd>
<dt><kbd><span class="option">--version-cert-manager-webhook <var>string</var></span></kbd></dt>
<dd><p>Cert Manager Web Hook version (default “quay.io/jetstack/cert-manager-webhook:v1.0.3”)</p>
</dd>
<dt><kbd><span class="option">--version-containerd <var>string</var></span></kbd></dt>
<dd><p>Containerd version (default “1.4.1”)</p>
</dd>
<dt><kbd><span class="option">--version-coredns <var>string</var></span></kbd></dt>
<dd><p>CoreDNS version (default “docker.io/coredns/coredns:1.8.0”)</p>
</dd>
<dt><kbd><span class="option">--version-crictl <var>string</var></span></kbd></dt>
<dd><p>CriCtl version (default “1.19.0”)</p>
</dd>
<dt><kbd><span class="option">--version-csi-attacher <var>string</var></span></kbd></dt>
<dd><p>CSI Attacher version (default “quay.io/k8scsi/csi-attacher:v2.1.1”)</p>
</dd>
<dt><kbd><span class="option">--version-csi-ceph-plugin <var>string</var></span></kbd></dt>
<dd><p>CSI Ceph Plugin version (default “quay.io/cephcsi/cephcsi:v3.1.1”)</p>
</dd>
<dt><kbd><span class="option">--version-csi-driver-registrar <var>string</var></span></kbd></dt>
<dd><p>CSI Driver Registrar version (default “quay.io/k8scsi/csi-node-driver-registrar:v1.3.0”)</p>
</dd>
<dt><kbd><span class="option">--version-csi-provisioner <var>string</var></span></kbd></dt>
<dd><p>CSI Provisioner version (default “quay.io/k8scsi/csi-provisioner:v1.6.0”)</p>
</dd>
<dt><kbd><span class="option">--version-csi-resizer <var>string</var></span></kbd></dt>
<dd><p>CSI Resizer version (default “quay.io/k8scsi/csi-resizer:v0.5.0”)</p>
</dd>
<dt><kbd><span class="option">--version-csi-snapshot-controller <var>string</var></span></kbd></dt>
<dd><p>CSI Snapshot Controller  version (default “quay.io/k8scsi/snapshot-controller:v2.0.1”)</p>
</dd>
<dt><kbd><span class="option">--version-csi-snapshotter <var>string</var></span></kbd></dt>
<dd><p>CSI Snapshotter version (default “quay.io/k8scsi/csi-snapshotter:v2.1.1”)</p>
</dd>
<dt><kbd><span class="option">--version-elasticsearch <var>string</var></span></kbd></dt>
<dd><p>Elasticsearch version (default “docker.elastic.co/elasticsearch/elasticsearch:7.9.2”)</p>
</dd>
<dt><kbd><span class="option">--version-etcd <var>string</var></span></kbd></dt>
<dd><p>Etcd version (default “quay.io/coreos/etcd:v3.4.13”)</p>
</dd>
<dt><kbd><span class="option">--version-fluent-bit <var>string</var></span></kbd></dt>
<dd><p>Fluent-Bit version (default “docker.io/fluent/fluent-bit:1.6.1”)</p>
</dd>
<dt><kbd><span class="option">--version-gobetween <var>string</var></span></kbd></dt>
<dd><p>Gobetween version (default “docker.io/yyyar/gobetween:0.8.0”)</p>
</dd>
<dt><kbd><span class="option">--version-grafana <var>string</var></span></kbd></dt>
<dd><p>Grafana version (default “docker.io/grafana/grafana:7.2.2”)</p>
</dd>
<dt><kbd><span class="option">--version-helm <var>string</var></span></kbd></dt>
<dd><p>Helm version (default “3.4.0”)</p>
</dd>
<dt><kbd><span class="option">--version-k8s <var>string</var></span></kbd></dt>
<dd><p>Kubernetes version (default “v1.19.3”)</p>
</dd>
<dt><kbd><span class="option">--version-kibana <var>string</var></span></kbd></dt>
<dd><p>Kibana version (default “docker.elastic.co/kibana/kibana:7.9.2”)</p>
</dd>
<dt><kbd><span class="option">--version-kube-apiserver <var>string</var></span></kbd></dt>
<dd><p>Kubernetes API Server version (default “k8s.gcr.io/kube-apiserver:v1.19.3”)</p>
</dd>
<dt><kbd><span class="option">--version-kube-controller-manager <var>string</var></span></kbd></dt>
<dd><p>Kubernetes Controller Manager (default “k8s.gcr.io/kube-controller-manager:v1.19.3”)</p>
</dd>
<dt><kbd><span class="option">--version-kube-proxy <var>string</var></span></kbd></dt>
<dd><p>Kubernetes Proxy version (default “k8s.gcr.io/kube-proxy:v1.19.3”)</p>
</dd>
<dt><kbd><span class="option">--version-kube-scheduler <var>string</var></span></kbd></dt>
<dd><p>Kubernetes Scheduler (default “k8s.gcr.io/kube-scheduler:v1.19.3”)</p>
</dd>
<dt><kbd><span class="option">--version-kube-state-metrics <var>string</var></span></kbd></dt>
<dd><p>Kube State Metrics version (default “quay.io/coreos/kube-state-metrics:v1.9.7”)</p>
</dd>
<dt><kbd><span class="option">--version-kubernetes-dashboard <var>string</var></span></kbd></dt>
<dd><p>Kubernetes Dashboard version (default “docker.io/kubernetesui/dashboard:v2.0.4”)</p>
</dd>
<dt><kbd><span class="option">--version-metallb-controller <var>string</var></span></kbd></dt>
<dd><p>MetalLB Controller version (default “docker.io/metallb/controller:v0.9.4”)</p>
</dd>
<dt><kbd><span class="option">--version-metallb-speaker <var>string</var></span></kbd></dt>
<dd><p>MetalLB Speaker version (default “docker.io/metallb/speaker:v0.9.4”)</p>
</dd>
<dt><kbd><span class="option">--version-metrics-server <var>string</var></span></kbd></dt>
<dd><p>Metrics Server version (default “k8s.gcr.io/metrics-server/metrics-server:v0.3.7”)</p>
</dd>
<dt><kbd><span class="option">--version-minio-client <var>string</var></span></kbd></dt>
<dd><p>Minio client version (default “docker.io/minio/mc:RELEASE.2020-10-03T02-54-56Z”)</p>
</dd>
<dt><kbd><span class="option">--version-minio-server <var>string</var></span></kbd></dt>
<dd><p>Minio server version (default “docker.io/minio/minio:RELEASE.2020-10-18T21-54-12Z”)</p>
</dd>
<dt><kbd><span class="option">--version-mysql <var>string</var></span></kbd></dt>
<dd><p>MySQL version (default “docker.io/library/mysql:8.0.19”)</p>
</dd>
<dt><kbd><span class="option">--version-nginx-ingress-admission-webhook <var>string</var></span></kbd></dt>
<dd><p>Nginx Ingress Admission Webhook version (default “docker.io/jettech/kube-webhook-certgen:v1.3.0”)</p>
</dd>
<dt><kbd><span class="option">--version-nginx-ingress-controller <var>string</var></span></kbd></dt>
<dd><p>Nginx Ingress Controller version (default “k8s.gcr.io/ingress-nginx/controller:v0.40.2”)</p>
</dd>
<dt><kbd><span class="option">--version-node-exporter <var>string</var></span></kbd></dt>
<dd><p>Node Exporter version (default “quay.io/prometheus/node-exporter:v1.0.1”)</p>
</dd>
<dt><kbd><span class="option">--version-pause <var>string</var></span></kbd></dt>
<dd><p>Pause version (default “k8s.gcr.io/pause:3.3”)</p>
</dd>
<dt><kbd><span class="option">--version-prometheus <var>string</var></span></kbd></dt>
<dd><p>Prometheus version (default “quay.io/prometheus/prometheus:v2.22.0”)</p>
</dd>
<dt><kbd><span class="option">--version-runc <var>string</var></span></kbd></dt>
<dd><p>Runc version (default “1.0.0-rc92”)</p>
</dd>
<dt><kbd><span class="option">--version-velero <var>string</var></span></kbd></dt>
<dd><p>Velero version (default “docker.io/velero/velero:v1.5.2”)</p>
</dd>
<dt><kbd><span class="option">--version-velero-plugin-aws <var>string</var></span></kbd></dt>
<dd><p>Velero Plugin AWS version (default “docker.io/velero/velero-plugin-for-aws:v1.1.0”)</p>
</dd>
<dt><kbd><span class="option">--version-velero-plugin-csi <var>string</var></span></kbd></dt>
<dd><p>Velero Plugin CSI version (default “docker.io/velero/velero-plugin-for-csi:v0.1.2”)</p>
</dd>
<dt><kbd><span class="option">--version-velero-restic-restore-helper <var>string</var></span></kbd></dt>
<dd><p>Velero Restic Restore Helper (default “docker.io/velero/velero-restic-restore-helper:v1.5.2”)</p>
</dd>
<dt><kbd><span class="option">--version-virtual-ip <var>string</var></span></kbd></dt>
<dd><p>Virtual-IP version (default “docker.io/darxkies/virtual-ip:0.1.4”)</p>
</dd>
<dt><kbd><span class="option">--version-wordpress <var>string</var></span></kbd></dt>
<dd><p>WordPress version (default “docker.io/library/wordpress:5.4-apache”)</p>
</dd>
<dt><kbd><span class="option">--vip-raft-controller-port <var>uint16</var></span></kbd></dt>
<dd><p>VIP Raft Controller Port (default 16277)</p>
</dd>
<dt><kbd><span class="option">--vip-raft-worker-port <var>uint16</var></span></kbd></dt>
<dd><p>VIP Raft Worker Port (default 16728)</p>
</dd>
<dt><kbd><span class="option">--worker-virtual-ip <var>string</var></span></kbd></dt>
<dd><p>Worker Virtual/Floating IP for the cluster</p>
</dd>
<dt><kbd><span class="option">--worker-virtual-ip-interface <var>string</var></span></kbd></dt>
<dd><p>Worker Virtual/Floating IP interface for the cluster</p>
</dd>
</dl>
</div></blockquote>
<p>The email and the ingress-domain parameters need to be changed if you want a working Ingress and Lets’ Encrypt configuration. It goes like this:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew configure --email john.doe@gmail.com --ingress-domain example.com
</pre></div>
</div>
</div></blockquote>
<p>Another important argument is <code class="file docutils literal notranslate"><span class="pre">--resolv-conf</span></code> which is used to define which resolv.conf file should be used for DNS.</p>
<p>The Virtual/Floating IP parameters should be accordingly changed if you want true HA. k8s-tew uses internally <a class="reference external" href="https://raft.github.io/">RAFT</a> and its leader election functionality to select one node on which the Virtual IP is set. If the leader fails, one of the remaining nodes gets the Virtual IP assigned.</p>
<section id="add-remote-node">
<h4>Add Remote Node<a class="headerlink" href="#add-remote-node" title="Permalink to this heading"></a></h4>
<p>A remote node can be added with the following command:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew node-add -n controller00 -i <span class="m">192</span>.168.100.100 -l controller,node,storage
</pre></div>
</div>
</div></blockquote>
<p>The arguments:</p>
<blockquote>
<div><dl class="option-list">
<dt><kbd><span class="option">-x</span>, <span class="option">--index <var>uint</var></span></kbd></dt>
<dd><p>The unique index of the node which should never be reused; if it is already in use a new one is assigned</p>
</dd>
<dt><kbd><span class="option">-i</span>, <span class="option">--ip <var>string</var></span></kbd></dt>
<dd><p>IP of the node (default “192.168.100.50”)</p>
</dd>
<dt><kbd><span class="option">-l</span>, <span class="option">--labels <var>string</var></span></kbd></dt>
<dd><p>The labels of the node which define the attributes of the node (default “controller,worker”)</p>
</dd>
<dt><kbd><span class="option">-n</span>, <span class="option">--name <var>string</var></span></kbd></dt>
<dd><p>The hostname of the node (default “single-node”)</p>
</dd>
<dt><kbd><span class="option">-s</span>, <span class="option">--self</span></kbd></dt>
<dd><p>Add this machine by inferring the host’s name &amp; IP and by setting the labels controller,worker,bootstrapper - The public-network and the deployment-directory are also updated</p>
</dd>
<dt><kbd><span class="option">-r</span>, <span class="option">--storage-index <var>uint</var></span></kbd></dt>
<dd><p>The unique index of the storage node which should never be reused; if it is already in use a new one is assigned</p>
</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure the IP address of the node matches the public network set using the configuration argument <code class="file docutils literal notranslate"><span class="pre">--public-network</span></code>.</p>
</div>
</section>
<section id="add-local-node">
<h4>Add Local Node<a class="headerlink" href="#add-local-node" title="Permalink to this heading"></a></h4>
<p>k8s-tew is also able to start a cluster on the local computer and for that the local computer has to be added as a node:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew node-add -s
</pre></div>
</div>
</div></blockquote>
<p>The arguments:</p>
<blockquote>
<div><dl class="option-list">
<dt><kbd><span class="option">-s</span>, <span class="option">--self</span></kbd></dt>
<dd><p>Add this machine by inferring the host’s name &amp; IP and by setting the labels controller,worker,bootstrapper - The public-network and the deployment-directory are also updated</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="remove-node">
<h4>Remove Node<a class="headerlink" href="#remove-node" title="Permalink to this heading"></a></h4>
<p>A node can be removed like this:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew node-remove -n controller00
</pre></div>
</div>
</div></blockquote>
</section>
<section id="list-nodes">
<h4>List Nodes<a class="headerlink" href="#list-nodes" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>And all the nodes can be listed with the command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew node-list
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="generating-files">
<h3>Generating Files<a class="headerlink" href="#generating-files" title="Permalink to this heading"></a></h3>
<p>Once all the nodes were added, the required files (third party binares, certificates, kubeconfigs and so on) have to be put in place. And this goes like this:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew generate
</pre></div>
</div>
</div></blockquote>
<p>The arguments:</p>
<blockquote>
<div><dl class="option-list">
<dt><kbd><span class="option">-r</span>, <span class="option">--command-retries <var>uint</var></span></kbd></dt>
<dd><p>The count of command retries during the setup (default 300)</p>
</dd>
<dt><kbd><span class="option">--force-download</span></kbd></dt>
<dd><p>Force downloading all binary dependencies from the internet</p>
</dd>
<dt><kbd><span class="option">--parallel</span></kbd></dt>
<dd><p>Download binary dependencies in parallel</p>
</dd>
<dt><kbd><span class="option">--pull-images</span></kbd></dt>
<dd><p>Pull and convert images to OCI to be deployed later on</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="run">
<h3>Run<a class="headerlink" href="#run" title="Permalink to this heading"></a></h3>
<p>With this command the local cluster can be started:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew run
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command will run in the foreground and it will supervise all the programs it started in the background.</p>
</div>
</section>
<section id="deploy">
<h3>Deploy<a class="headerlink" href="#deploy" title="Permalink to this heading"></a></h3>
<p>In case remote nodes were added with the deploy command, the remotely missing files are copied to the nodes. k8s-tew is installed and started as a service.</p>
<p>The deployment is executed with the command:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew deploy
</pre></div>
</div>
</div></blockquote>
<p>The arguments:</p>
<blockquote>
<div><dl class="option-list">
<dt><kbd><span class="option">-r</span>, <span class="option">--command-retries <var>uint</var></span></kbd></dt>
<dd><p>The number of command retries during the setup (default 1200)</p>
</dd>
<dt><kbd><span class="option">--force-upload</span></kbd></dt>
<dd><p>Files are uploaded without checking if they are already installed</p>
</dd>
<dt><kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></dt>
<dd><p>help for deploy</p>
</dd>
<dt><kbd><span class="option">-i</span>, <span class="option">--identity-file <var>string</var></span></kbd></dt>
<dd><p>SSH identity file (default “/home/darxkies/.ssh/id_rsa”)</p>
</dd>
<dt><kbd><span class="option">--import-images</span></kbd></dt>
<dd><p>Install images</p>
</dd>
<dt><kbd><span class="option">--parallel</span></kbd></dt>
<dd><p>Run steps in parallel</p>
</dd>
<dt><kbd><span class="option">--skip-backup-setup</span></kbd></dt>
<dd><p>Skip backup setup</p>
</dd>
<dt><kbd><span class="option">--skip-ingress-setup</span></kbd></dt>
<dd><p>Skip ingress setup</p>
</dd>
<dt><kbd><span class="option">--skip-logging-setup</span></kbd></dt>
<dd><p>Skip logging setup</p>
</dd>
<dt><kbd><span class="option">--skip-monitoring-setup</span></kbd></dt>
<dd><p>Skip monitoring setup</p>
</dd>
<dt><kbd><span class="option">--skip-restart</span></kbd></dt>
<dd><p>Skip restart steps</p>
</dd>
<dt><kbd><span class="option">--skip-setup</span></kbd></dt>
<dd><p>Skip setup steps</p>
</dd>
<dt><kbd><span class="option">--skip-showcase-setup</span></kbd></dt>
<dd><p>Skip showcase setup</p>
</dd>
<dt><kbd><span class="option">--skip-storage-setup</span></kbd></dt>
<dd><p>Skip storage setup and all other feature setup steps</p>
</dd>
<dt><kbd><span class="option">--skip-upload</span></kbd></dt>
<dd><p>Skip upload steps</p>
</dd>
<dt><kbd><span class="option">--wait <var>uint</var></span></kbd></dt>
<dd><p>Wait for all cluster relevant pods to be ready and jobs to be completed. The parameter reflects the number of seconds in which the pods have to run stable.</p>
</dd>
</dl>
</div></blockquote>
<p>The files are copied using scp and the ssh private key <code class="file docutils literal notranslate"><span class="pre">$HOME/.ssh/id_rsa</span></code>. In case the file <code class="file docutils literal notranslate"><span class="pre">$HOME/.ssh/id_rsa</span></code> does not exist it should be generated using the command <code class="file docutils literal notranslate"><span class="pre">ssh-keygen</span></code>. If another private key should be used, it can be specified using the command line argument <code class="file docutils literal notranslate"><span class="pre">-i</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The argument <code class="file docutils literal notranslate"><span class="pre">--pull-images</span></code> downloads the required Docker Images on the nodes, before the setup process is executed. That could speed up the whole setup process later on. Furthermore, by using <code class="file docutils literal notranslate"><span class="pre">--parallel</span></code> the process of uploading files to the nodes and the download of Docker Images can be again considerable shortened. Use these parameters with caution, as they can starve your network.</p>
</div>
</section>
</section>
<section id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Permalink to this heading"></a></h2>
<p>After starting the cluster, the user will need some environment variables set locally to make the interaction with the cluster easier. This is done with this command:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> &lt;<span class="o">(</span>k8s-tew environment<span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<p>This command sets KUBECONFIG needed by kubectl to communicate with the cluster and it also updates PATH to point to the downloaded third-party binaries.</p>
</section>
<section id="dashboards-websites">
<h2>Dashboards &amp; Websites<a class="headerlink" href="#dashboards-websites" title="Permalink to this heading"></a></h2>
<p>Depending on the configuration of the cluster, the installation of all containers can take a while. Once everything is installed, the following command can be used to display the credentials (username + generated password) and open the web browser (by passing -o) pointing to the web sites hosted by the cluster:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew dashboard XXX
</pre></div>
</div>
</div></blockquote>
<p>XXX is a place holder and can be replaced with one of the following values:</p>
<blockquote>
<div><ul class="simple">
<li><p>ceph-manager - Display Ceph Manager website related information</p></li>
<li><p>ceph-rados-gateway - Display Ceph Rados Gateway website related information</p></li>
<li><p>cerebro - Display Cerebro website related information</p></li>
<li><p>grafana - Display Grafana website related information</p></li>
<li><p>kibana - Display Kibana website related information</p></li>
<li><p>kubernetes - Display Kuberenetes Dashboard website related information</p></li>
<li><p>minio - Display Minio website related information</p></li>
<li><p>wordpress-ingress - Display WordPress Ingress website related information</p></li>
<li><p>wordpress-nodeport - Display WordPress Nodeport website related information</p></li>
</ul>
</div></blockquote>
<section id="ingress">
<h3>Ingress<a class="headerlink" href="#ingress" title="Permalink to this heading"></a></h3>
<p>For working Ingress make sure ports 80 and 443 are available. The Ingress Domain have to be also configured before ‘generate’ and ‘deploy’ are executed:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>k8s-tew configure --ingress-domain <span class="o">[</span>ingress-domain<span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="setups.html" class="btn btn-neutral float-right" title="Setups" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Mircea-Cristian Racasan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>